{"version":3,"file":"arcgis-source.js","sources":["src/mixin/arcgis-source.js"],"sourcesContent":["import { cleanSourceExtraParams, ARCGIS_EXTRA_PARAMS } from '../ol-ext'\nimport { isEqual, pick } from '../util/minilo'\nimport { makeWatchers } from '../util/vue-helpers'\n\nconst serialize = value => {\n  if (value == null) return value\n\n  return typeof value === 'object' ? JSON.stringify(value) : value\n}\n\nexport default {\n  props: {\n    /**\n     * Extra ArcGIS request parameters\n     * todo rename to extraParams\n     */\n    extParams: Object,\n    format: {\n      type: String,\n      default: 'PNG32',\n    },\n    layers: String,\n    layerDefs: [Object, String],\n    dynamicLayers: [Object, String],\n    dpi: Number,\n    transparent: {\n      type: Boolean,\n      default: true,\n    },\n    time: String,\n    layerTimeOptions: [Object, String],\n    gdbVersion: String,\n    mapScale: String,\n    rotation: Number,\n    datumTransformations: [Array, String],\n    mapRangeValues: [Array, String],\n    layerRangeValues: [Array, String],\n    layerParameterValues: [Array, String],\n    historicMoment: Number,\n  },\n  computed: {\n    // todo rename to cleanExtraParams\n    cleanExtParams () {\n      return this.extParams\n        ? cleanSourceExtraParams(this.extParams, ARCGIS_EXTRA_PARAMS)\n        : undefined\n    },\n    allParams () {\n      return {\n        ...this.cleanExtParams,\n        LAYERS: this.layers,\n        FORMAT: this.format,\n        LAYERDEFS: serialize(this.layerDefs),\n        DYNAMICLAYERS: serialize(this.dynamicLayers),\n        DPI: this.dpi,\n        TRANSPARENT: this.transparent,\n        TIME: serialize(this.time),\n        LAYERTIMEOPTIONS: serialize(this.layerTimeOptions),\n        GDBVERSION: this.gdbVersion,\n        MAPSCALE: this.mapScale,\n        ROTATION: this.rotation,\n        DATUMTRANSFORMATIONS: serialize(this.datumTransformations),\n        MAPRANGEVALUES: serialize(this.mapRangeValues),\n        LAYERRANGEVALUES: serialize(this.layerRangeValues),\n        LAYERPARAMETERVALUES: serialize(this.layerParameterValues),\n        HISTORICMOMENT: serialize(this.historicMoment),\n      }\n    },\n  },\n  watch: {\n    ...makeWatchers([\n      'layers',\n      'format',\n      'dpi',\n      'transparent',\n      'gdbVersion',\n      'mapScale',\n      'rotation',\n      'historicMoment',\n    ], prop => function (value) {\n      if (!this.$source) return\n\n      prop = prop.toUpperCase()\n      const params = this.$source.getParams() || {}\n\n      if (isEqual(value, params[value])) return\n\n      this.$source.updateParams({ [prop]: value })\n    }),\n    ...makeWatchers([\n      'layerDefs',\n      'dynamicLayers',\n      'time',\n      'layerTimeOptions',\n      'datumTransformations',\n      'mapRangeValues',\n      'layerRangeValues',\n      'layerParameterValues',\n    ], prop => function (value) {\n      if (!this.$source) return\n\n      prop = prop.toUpperCase()\n      value = serialize(value)\n      const params = this.$source.getParams() || {}\n\n      if (isEqual(value, params[value])) return\n\n      this.$source.updateParams({ [prop]: value })\n    }),\n    extParams (value) {\n      if (!this.$source) return\n\n      const params = pick(this.$source.getParams() || {}, Object.keys(value))\n      if (isEqual(value, params)) return\n\n      this.$source.updateParams(value ? cleanSourceExtraParams(value) : undefined)\n    },\n  },\n}\n"],"names":["serialize","value","JSON","stringify","props","extParams","Object","format","type","String","default","layers","layerDefs","dynamicLayers","dpi","Number","transparent","Boolean","time","layerTimeOptions","gdbVersion","mapScale","rotation","datumTransformations","Array","mapRangeValues","layerRangeValues","layerParameterValues","historicMoment","computed","cleanExtParams","cleanSourceExtraParams","ARCGIS_EXTRA_PARAMS","undefined","allParams","LAYERS","FORMAT","LAYERDEFS","DYNAMICLAYERS","DPI","TRANSPARENT","TIME","LAYERTIMEOPTIONS","GDBVERSION","MAPSCALE","ROTATION","DATUMTRANSFORMATIONS","MAPRANGEVALUES","LAYERRANGEVALUES","LAYERPARAMETERVALUES","HISTORICMOMENT","watch","makeWatchers","prop","$source","toUpperCase","params","getParams","isEqual","updateParams","pick","keys"],"mappings":"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"}