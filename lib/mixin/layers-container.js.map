{"version":3,"file":"layers-container.js","sources":["src/mixin/layers-container.js"],"sourcesContent":["import Collection from 'ol/Collection'\nimport BaseLayer from 'ol/layer/Base'\nimport Vue from 'vue'\nimport { merge as mergeObs } from 'rxjs/observable'\nimport { getLayerId, initializeLayer } from '../ol-ext'\nimport { observableFromOlEvent } from '../rx-ext'\nimport { instanceOf } from '../util/assert'\nimport rxSubs from './rx-subs'\n\nexport default {\n  mixins: [rxSubs],\n  computed: {\n    layerIds () {\n      if (!this.rev) return []\n\n      return this.getLayers().map(getLayerId)\n    },\n  },\n  methods: {\n    /**\n     * @param {BaseLayer|Vue} layer\n     * @return {void}\n     */\n    addLayer (layer) {\n      layer = layer instanceof Vue ? layer.$layer : layer\n      instanceOf(layer, BaseLayer)\n\n      if (this.getLayerById(getLayerId(layer)) == null) {\n        initializeLayer(layer)\n        this._layersCollection.push(layer)\n      }\n    },\n    /**\n     * @param {BaseLayer|Vue} layer\n     * @return {void}\n     */\n    removeLayer (layer) {\n      layer = this.getLayerById(getLayerId(layer))\n      if (!layer) return\n\n      this._layersCollection.remove(layer)\n    },\n    /**\n     * @return {BaseLayer[]}\n     */\n    getLayers () {\n      return this._layersCollection.getArray()\n    },\n    /**\n     * @return {module:ol/Collection~Collection<BaseLayer>}\n     */\n    getLayersCollection () {\n      return this._layersCollection\n    },\n    /**\n     * @param {string|number} layerId\n     * @return {BaseLayer|undefined}\n     */\n    getLayerById (layerId) {\n      return this._layersCollection.getArray().find(layer => {\n        return getLayerId(layer) === layerId\n      })\n    },\n    /**\n     * @return {void}\n     */\n    clearLayers () {\n      this._layersCollection.clear()\n    },\n    /**\n     * @returns {Object}\n     * @protected\n     */\n    getServices () {\n      const vm = this\n\n      return {\n        get layersContainer () { return vm },\n      }\n    },\n  },\n  created () {\n    /**\n     * @type {Collection<BaseLayer>}\n     * @private\n     */\n    this._layersCollection = new Collection()\n\n    const add = observableFromOlEvent(this._layersCollection, 'add')\n    const remove = observableFromOlEvent(this._layersCollection, 'remove')\n    const events = mergeObs(add, remove)\n\n    this.subscribeTo(events, ({ type, element }) => {\n      ++this.rev\n\n      this.$emit(type + ':layer', element)\n    })\n  },\n}\n"],"names":["mixins","rxSubs","computed","layerIds","rev","getLayers","map","getLayerId","methods","addLayer","layer","Vue","$layer","instanceOf","BaseLayer","getLayerById","initializeLayer","_layersCollection","push","removeLayer","remove","getArray","getLayersCollection","layerId","find","clearLayers","clear","getServices","vm","layersContainer","created","Collection","add","observableFromOlEvent","events","mergeObs","subscribeTo","type","element","$emit"],"mappings":";;;;;;;;;;;;;;;;;;;AASA,sBAAe;EACbA,MAAM,EAAE,CAACC,MAAD,CADK;EAEbC,QAAQ,EAAE;IACRC,QADQ,sBACI;UACN,CAAC,KAAKC,GAAV,EAAe,OAAO,EAAP;aAER,KAAKC,SAAL,GAAiBC,GAAjB,CAAqBC,UAArB,CAAP;;GANS;EASbC,OAAO,EAAE;;;;;IAKPC,QALO,oBAKGC,KALH,EAKU;MACfA,KAAK,GAAGA,KAAK,YAAYC,GAAjB,GAAuBD,KAAK,CAACE,MAA7B,GAAsCF,KAA9C;MACAG,UAAU,CAACH,KAAD,EAAQI,SAAR,CAAV;;UAEI,KAAKC,YAAL,CAAkBR,UAAU,CAACG,KAAD,CAA5B,KAAwC,IAA5C,EAAkD;QAChDM,eAAe,CAACN,KAAD,CAAf;;aACKO,iBAAL,CAAuBC,IAAvB,CAA4BR,KAA5B;;KAXG;;;;;;IAkBPS,WAlBO,uBAkBMT,KAlBN,EAkBa;MAClBA,KAAK,GAAG,KAAKK,YAAL,CAAkBR,UAAU,CAACG,KAAD,CAA5B,CAAR;UACI,CAACA,KAAL,EAAY;;WAEPO,iBAAL,CAAuBG,MAAvB,CAA8BV,KAA9B;KAtBK;;;;;IA2BPL,SA3BO,uBA2BM;aACJ,KAAKY,iBAAL,CAAuBI,QAAvB,EAAP;KA5BK;;;;;IAiCPC,mBAjCO,iCAiCgB;aACd,KAAKL,iBAAZ;KAlCK;;;;;;IAwCPF,YAxCO,wBAwCOQ,OAxCP,EAwCgB;aACd,KAAKN,iBAAL,CAAuBI,QAAvB,GAAkCG,IAAlC,CAAuC,UAAAd,KAAK,EAAI;eAC9CH,UAAU,CAACG,KAAD,CAAV,KAAsBa,OAA7B;OADK,CAAP;KAzCK;;;;;IAgDPE,WAhDO,yBAgDQ;WACRR,iBAAL,CAAuBS,KAAvB;KAjDK;;;;;;IAuDPC,WAvDO,yBAuDQ;UACPC,EAAE,GAAG,IAAX;aAEO;YACDC,eAAJ,GAAuB;iBAASD,EAAP;;;OAD3B;;GAnES;EAwEbE,OAxEa,qBAwEF;;;;;;;SAKJb,iBAAL,GAAyB,IAAIc,UAAJ,EAAzB;QAEMC,GAAG,GAAGC,qBAAqB,CAAC,KAAKhB,iBAAN,EAAyB,KAAzB,CAAjC;QACMG,MAAM,GAAGa,qBAAqB,CAAC,KAAKhB,iBAAN,EAAyB,QAAzB,CAApC;QACMiB,MAAM,GAAGC,KAAQ,CAACH,GAAD,EAAMZ,MAAN,CAAvB;SAEKgB,WAAL,CAAiBF,MAAjB,EAAyB,gBAAuB;UAApBG,IAAoB,QAApBA,IAAoB;UAAdC,OAAc,QAAdA,OAAc;QAC5C,KAAI,CAAClC,GAAP;;MAEA,KAAI,CAACmC,KAAL,CAAWF,IAAI,GAAG,QAAlB,EAA4BC,OAA5B;KAHF;;CAnFJ;;;;"}