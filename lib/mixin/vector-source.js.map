{"version":3,"file":"vector-source.js","sources":["src/mixin/vector-source.js"],"sourcesContent":["import { merge as mergeObs } from 'rxjs/observable'\nimport { debounceTime } from 'rxjs/operators'\nimport { observableFromOlEvent } from '../rx-ext'\nimport * as assert from '../util/assert'\nimport mergeDescriptors from '../util/multi-merge-descriptors'\nimport { makeWatchers } from '../util/vue-helpers'\nimport featuresContainer from './features-container'\nimport projTransforms from './proj-transforms'\nimport source from './source'\n\nexport default {\n  mixins: [source, featuresContainer, projTransforms],\n  props: {\n    useSpatialIndex: {\n      type: Boolean,\n      default: true,\n    },\n  },\n  methods: {\n    /**\n     * @return {void}\n     */\n    clear () {\n      this::featuresContainer.methods.clearFeatures()\n    },\n    /**\n     * @return {Object}\n     * @protected\n     */\n    getServices () {\n      return mergeDescriptors(\n        this::source.methods.getServices(),\n        this::featuresContainer.methods.getServices(),\n      )\n    },\n    /**\n     * @return {Promise}\n     * @protected\n     */\n    init () {\n      return this::source.methods.init()\n    },\n    /**\n     * @return {void|Promise<void>}\n     * @protected\n     */\n    deinit () {\n      return this::source.methods.deinit()\n    },\n    /**\n     * @return {void}\n     * @protected\n     */\n    mount () {\n      return this::source.methods.mount()\n    },\n    /**\n     * @return {void}\n     * @protected\n     */\n    unmount () {\n      this.clear()\n      return this::source.methods.unmount()\n    },\n    /**\n     * @return {void}\n     * @protected\n     */\n    subscribeAll () {\n      this::source.methods.subscribeAll()\n      this::subscribeToEvents()\n    },\n    /**\n     * @param feature\n     * @return {ReadonlyArray<any>}\n     * @protected\n     */\n    writeFeatureInDataProj (feature) {\n      return this::projTransforms.methods.writeFeatureInDataProj(feature)\n    },\n    /**\n     * @param feature\n     * @return {ReadonlyArray<any>}\n     * @protected\n     */\n    writeGeometryInViewProj (feature) {\n      return this::projTransforms.methods.writeFeatureInViewProj(feature)\n    },\n  },\n  watch: {\n    ...makeWatchers([\n      'useSpatialIndex',\n    ], () => function () {\n      return this.scheduleRecreate()\n    }),\n  },\n  stubVNode: {\n    empty: false,\n    attrs () {\n      return {\n        class: this.$options.name,\n      }\n    },\n  },\n}\n\nfunction subscribeToEvents () {\n  assert.hasSource(this)\n\n  const add = observableFromOlEvent(this.getFeaturesCollection(), 'add')\n  const remove = observableFromOlEvent(this.getFeaturesCollection(), 'remove')\n  const events = mergeObs(add, remove).pipe(debounceTime(1000 / 60))\n  // emit event to allow `sync` modifier\n  this.subscribeTo(events, () => {\n    this.$emit('update:features', this.featuresDataProj)\n  })\n}\n"],"names":["mixins","source","featuresContainer","projTransforms","props","useSpatialIndex","type","Boolean","default","methods","clear","clearFeatures","getServices","mergeDescriptors","init","deinit","mount","unmount","subscribeAll","subscribeToEvents","writeFeatureInDataProj","feature","writeGeometryInViewProj","writeFeatureInViewProj","watch","makeWatchers","scheduleRecreate","stubVNode","empty","attrs","class","$options","name","assert","add","observableFromOlEvent","getFeaturesCollection","remove","events","mergeObs","pipe","debounceTime","subscribeTo","$emit","featuresDataProj"],"mappings":";;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;AAUA,mBAAe;EACbA,MAAM,EAAE,CAACC,MAAD,EAASC,iBAAT,EAA4BC,cAA5B,CADK;EAEbC,KAAK,EAAE;IACLC,eAAe,EAAE;MACfC,IAAI,EAAEC,OADS;MAEfC,OAAO,EAAE;;GALA;EAQbC,OAAO,EAAE;;;;IAIPC,KAJO,mBAIE;MACDR,iBAAiB,CAACO,OAAlB,CAA0BE,aAAhC;KALK;;;;;;IAWPC,WAXO,yBAWQ;aACNC,gBAAgB,CACfZ,MAAM,CAACQ,OAAP,CAAeG,WAArB,WADqB,EAEfV,iBAAiB,CAACO,OAAlB,CAA0BG,WAAhC,WAFqB,CAAvB;KAZK;;;;;;IAqBPE,IArBO,kBAqBC;aACOb,MAAM,CAACQ,OAAP,CAAeK,IAArB,WAAP;KAtBK;;;;;;IA4BPC,MA5BO,oBA4BG;aACKd,MAAM,CAACQ,OAAP,CAAeM,MAArB,WAAP;KA7BK;;;;;;IAmCPC,KAnCO,mBAmCE;aACMf,MAAM,CAACQ,OAAP,CAAeO,KAArB,WAAP;KApCK;;;;;;IA0CPC,OA1CO,qBA0CI;WACJP,KAAL;aACaT,MAAM,CAACQ,OAAP,CAAeQ,OAArB,WAAP;KA5CK;;;;;;IAkDPC,YAlDO,0BAkDS;MACRjB,MAAM,CAACQ,OAAP,CAAeS,YAArB;MACMC,iBAAN;KApDK;;;;;;;IA2DPC,sBA3DO,kCA2DiBC,OA3DjB,EA2D0B;aAClBlB,cAAc,CAACM,OAAf,CAAuBW,sBAA7B,YAAoDC,OAApD,CAAP;KA5DK;;;;;;;IAmEPC,uBAnEO,mCAmEkBD,OAnElB,EAmE2B;aACnBlB,cAAc,CAACM,OAAf,CAAuBc,sBAA7B,YAAoDF,OAApD,CAAP;;GA5ES;EA+EbG,KAAK,oBACAC,YAAY,CAAC,CACd,iBADc,CAAD,EAEZ;WAAM,YAAY;aACZ,KAAKC,gBAAL,EAAP;KADC;GAFY,CADZ,CA/EQ;EAsFbC,SAAS,EAAE;IACTC,KAAK,EAAE,KADE;IAETC,KAFS,mBAEA;aACA;QACLC,KAAK,EAAE,KAAKC,QAAL,CAAcC;OADvB;;;CAzFN;;AAgGA,SAASb,iBAAT,GAA8B;;;EAC5Bc,SAAA,CAAiB,IAAjB;MAEMC,GAAG,GAAGC,qBAAqB,CAAC,KAAKC,qBAAL,EAAD,EAA+B,KAA/B,CAAjC;MACMC,MAAM,GAAGF,qBAAqB,CAAC,KAAKC,qBAAL,EAAD,EAA+B,QAA/B,CAApC;MACME,MAAM,GAAGC,KAAQ,CAACL,GAAD,EAAMG,MAAN,CAAR,CAAsBG,IAAtB,CAA2BC,YAAY,CAAC,OAAO,EAAR,CAAvC,CAAf,CAL4B;;OAOvBC,WAAL,CAAiBJ,MAAjB,EAAyB,YAAM;IAC7B,KAAI,CAACK,KAAL,CAAW,iBAAX,EAA8B,KAAI,CAACC,gBAAnC;GADF;;;;;"}