{"version":3,"file":"style.js","sources":["src/mixin/style.js"],"sourcesContent":["import { first as firstObs } from 'rxjs/operators'\nimport mergeDescriptors from '../util/multi-merge-descriptors'\nimport { observableFromOlEvent } from '../rx-ext'\nimport cmp from './ol-virt-cmp'\nimport useMapCmp from './use-map-cmp'\n\n/**\n * Basic style mixin.\n */\nexport default {\n  mixins: [cmp, useMapCmp],\n  methods: {\n    /**\n     * @return {OlStyle|Promise<OlStyle>}\n     * @protected\n     */\n    createOlObject () {\n      return this.createStyle()\n    },\n    /**\n     * @return {OlStyle|Promise<OlStyle>}\n     * @protected\n     * @abstract\n     */\n    createStyle () {\n      throw new Error('Not implemented method')\n    },\n    /**\n     * @return {Promise}\n     * @protected\n     */\n    init () {\n      return this::cmp.methods.init()\n    },\n    /**\n     * @return {void|Promise<void>}\n     * @protected\n     */\n    deinit () {\n      return this::cmp.methods.deinit()\n    },\n    /**\n     * @return {Object}\n     * @protected\n     */\n    getServices () {\n      const vm = this\n\n      return mergeDescriptors(this::cmp.methods.getServices(), {\n        get style () { return vm.$style },\n      })\n    },\n    /**\n     * @return {Promise}\n     */\n    refresh () {\n      if (this.$olObject == null) return Promise.resolve()\n\n      return this.remount()\n        .then(() => {\n          if (!this.$map) {\n            return\n          }\n\n          this.$map.render()\n\n          return observableFromOlEvent(this.$map, 'postcompose')\n            .pipe(firstObs())\n            .toPromise()\n        })\n    },\n  },\n  stubVNode: {\n    empty () {\n      return this.$options.name\n    },\n  },\n  created () {\n    this::defineServices()\n  },\n}\n\nfunction defineServices () {\n  Object.defineProperties(this, {\n    $style: {\n      enumerable: true,\n      get: () => this.$olObject,\n    },\n    $map: {\n      enumerable: true,\n      get: () => this.$services && this.$services.map,\n    },\n    $view: {\n      enumerable: true,\n      get: () => this.$services && this.$services.view,\n    },\n    $stylesContainer: {\n      enumerable: true,\n      get: () => this.$services && this.$services.stylesContainer,\n    },\n  })\n}\n"],"names":["mixins","cmp","useMapCmp","methods","createOlObject","createStyle","Error","init","deinit","getServices","vm","mergeDescriptors","style","$style","refresh","$olObject","Promise","resolve","remount","then","$map","render","observableFromOlEvent","pipe","firstObs","toPromise","stubVNode","empty","$options","name","created","defineServices","Object","defineProperties","enumerable","get","$services","map","$view","view","$stylesContainer","stylesContainer"],"mappings":";;;;;;;;;;;;;;;;AAMA;;;;AAGA,YAAe;EACbA,MAAM,EAAE,CAACC,GAAD,EAAMC,SAAN,CADK;EAEbC,OAAO,EAAE;;;;;IAKPC,cALO,4BAKW;aACT,KAAKC,WAAL,EAAP;KANK;;;;;;;IAaPA,WAbO,yBAaQ;YACP,IAAIC,KAAJ,CAAU,wBAAV,CAAN;KAdK;;;;;;IAoBPC,IApBO,kBAoBC;aACON,GAAG,CAACE,OAAJ,CAAYI,IAAlB,WAAP;KArBK;;;;;;IA2BPC,MA3BO,oBA2BG;aACKP,GAAG,CAACE,OAAJ,CAAYK,MAAlB,WAAP;KA5BK;;;;;;IAkCPC,WAlCO,yBAkCQ;UACPC,EAAE,GAAG,IAAX;aAEOC,gBAAgB,CAAOV,GAAG,CAACE,OAAJ,CAAYM,WAAlB,WAAD,EAAkC;YACnDG,KAAJ,GAAa;iBAASF,EAAE,CAACG,MAAV;;;OADM,CAAvB;KArCK;;;;;IA4CPC,OA5CO,qBA4CI;;;UACL,KAAKC,SAAL,IAAkB,IAAtB,EAA4B,OAAOC,OAAO,CAACC,OAAR,EAAP;aAErB,KAAKC,OAAL,GACJC,IADI,CACC,YAAM;YACN,CAAC,KAAI,CAACC,IAAV,EAAgB;;;;QAIhB,KAAI,CAACA,IAAL,CAAUC,MAAV;;eAEOC,qBAAqB,CAAC,KAAI,CAACF,IAAN,EAAY,aAAZ,CAArB,CACJG,IADI,CACCC,KAAQ,EADT,EAEJC,SAFI,EAAP;OARG,CAAP;;GAjDS;EA+DbC,SAAS,EAAE;IACTC,KADS,mBACA;aACA,KAAKC,QAAL,CAAcC,IAArB;;GAjES;EAoEbC,OApEa,qBAoEF;IACHC,cAAN;;CArEJ;;AAyEA,SAASA,cAAT,GAA2B;;;EACzBC,MAAM,CAACC,gBAAP,CAAwB,IAAxB,EAA8B;IAC5BpB,MAAM,EAAE;MACNqB,UAAU,EAAE,IADN;MAENC,GAAG,EAAE;eAAM,MAAI,CAACpB,SAAX;;KAHqB;IAK5BK,IAAI,EAAE;MACJc,UAAU,EAAE,IADR;MAEJC,GAAG,EAAE;eAAM,MAAI,CAACC,SAAL,IAAkB,MAAI,CAACA,SAAL,CAAeC,GAAvC;;KAPqB;IAS5BC,KAAK,EAAE;MACLJ,UAAU,EAAE,IADP;MAELC,GAAG,EAAE;eAAM,MAAI,CAACC,SAAL,IAAkB,MAAI,CAACA,SAAL,CAAeG,IAAvC;;KAXqB;IAa5BC,gBAAgB,EAAE;MAChBN,UAAU,EAAE,IADI;MAEhBC,GAAG,EAAE;eAAM,MAAI,CAACC,SAAL,IAAkB,MAAI,CAACA,SAAL,CAAeK,eAAvC;;;GAfT;;;;;"}