{"version":3,"file":"interaction.js","sources":["src/mixin/interaction.js"],"sourcesContent":["import uuid from 'uuid/v4'\nimport {\n  getInteractionId,\n  getInteractionPriority,\n  initializeInteraction,\n  setInteractionId,\n  setInteractionPriority,\n} from '../ol-ext'\nimport { isEqual } from '../util/minilo'\nimport mergeDescriptors from '../util/multi-merge-descriptors'\nimport cmp from './ol-virt-cmp'\nimport useMapCmp from './use-map-cmp'\n\nexport default {\n  mixins: [cmp, useMapCmp],\n  props: {\n    id: {\n      type: [String, Number],\n      default: () => uuid(),\n    },\n    active: {\n      type: Boolean,\n      default: true,\n    },\n    /**\n     * Priority of interactions in the event handling stream.\n     * The higher the value, the sooner it will handle map event.\n     * @type {number}\n     */\n    priority: {\n      type: Number,\n      default: 0,\n    },\n  },\n  methods: {\n    /**\n     * @return {Promise<module:ol/interaction/Interaction~Interaction>}\n     * @protected\n     */\n    async createOlObject () {\n      const interaction = await this.createInteraction()\n\n      initializeInteraction(interaction, this.id, this.priority)\n      interaction.setActive(this.active)\n\n      return interaction\n    },\n    /**\n     * @return {module:ol/interaction/Interaction~Interaction|Promise<module:ol/interaction/Interaction~Interaction>}\n     * @protected\n     * @abstract\n     */\n    createInteraction () {\n      throw new Error('Not implemented method')\n    },\n    /**\n     * @returns {Object}\n     * @protected\n     */\n    getServices () {\n      const vm = this\n\n      return mergeDescriptors(this::cmp.methods.getServices(), {\n        get interaction () { return vm.$interaction },\n      })\n    },\n    /**\n     * @return {Promise} Resolves when initialization completes\n     * @protected\n     */\n    init () {\n      return this::cmp.methods.init()\n    },\n    /**\n     * @return {void|Promise<void>}\n     * @protected\n     */\n    deinit () {\n      return this::cmp.methods.deinit()\n    },\n    /**\n     * @return {void}\n     * @protected\n     */\n    mount () {\n      this.$interactionsContainer && this.$interactionsContainer.addInteraction(this)\n      this.subscribeAll()\n    },\n    /**\n     * @return {void}\n     * @protected\n     */\n    unmount () {\n      this.unsubscribeAll()\n      this.$interactionsContainer && this.$interactionsContainer.removeInteraction(this)\n    },\n    /**\n     * @return {Promise}\n     */\n    refresh () {\n      return this::cmp.methods.refresh()\n    },\n    /**\n     * @return {Promise}\n     */\n    recreate () {\n      return this::cmp.methods.recreate()\n    },\n    /**\n     * @return {Promise}\n     */\n    remount () {\n      return this::cmp.methods.remount()\n    },\n    /**\n     * @protected\n     */\n    subscribeAll () {\n    },\n  },\n  watch: {\n    id (value) {\n      if (!this.$interaction || isEqual(value, getInteractionId(value))) {\n        return\n      }\n\n      setInteractionId(this.$interaction, value)\n    },\n    active (value) {\n      if (!this.$interaction || value === this.$interaction.getActive()) {\n        return\n      }\n\n      this.$interaction.setActive(value)\n    },\n    priority (value) {\n      if (\n        !this.$interaction ||\n        !this.$interactionsContainer ||\n        value === getInteractionPriority(this.$interaction)\n      ) {\n        return\n      }\n\n      setInteractionPriority(this.$interaction, value)\n      // todo replace with event\n      this.$interactionsContainer.sortInteractions()\n    },\n  },\n  stubVNode: {\n    empty () {\n      return this.$options.name\n    },\n  },\n  created () {\n    this::defineServices()\n  },\n}\n\nfunction defineServices () {\n  Object.defineProperties(this, {\n    /**\n     * @type {module:ol/interaction/Interaction~Interaction|undefined}\n     */\n    $interaction: {\n      enumerable: true,\n      get: () => this.$olObject,\n    },\n    $map: {\n      enumerable: true,\n      get: () => this.$services && this.$services.map,\n    },\n    $view: {\n      enumerable: true,\n      get: () => this.$services && this.$services.view,\n    },\n    $interactionsContainer: {\n      enumerable: true,\n      get: () => this.$services && this.$services.interactionsContainer,\n    },\n  })\n}\n"],"names":["mixins","cmp","useMapCmp","props","id","type","String","Number","default","uuid","active","Boolean","priority","methods","createOlObject","createInteraction","interaction","initializeInteraction","setActive","Error","getServices","vm","mergeDescriptors","$interaction","init","deinit","mount","$interactionsContainer","addInteraction","subscribeAll","unmount","unsubscribeAll","removeInteraction","refresh","recreate","remount","watch","value","isEqual","getInteractionId","setInteractionId","getActive","getInteractionPriority","setInteractionPriority","sortInteractions","stubVNode","empty","$options","name","created","defineServices","Object","defineProperties","enumerable","get","$olObject","$map","$services","map","$view","view","interactionsContainer"],"mappings":"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"}