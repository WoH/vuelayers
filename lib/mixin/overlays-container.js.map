{"version":3,"file":"overlays-container.js","sources":["src/mixin/overlays-container.js"],"sourcesContent":["import Collection from 'ol/Collection'\nimport Overlay from 'ol/Overlay'\nimport Vue from 'vue'\nimport { merge as mergeObs } from 'rxjs/observable'\nimport { getOverlayId, initializeOverlay } from '../ol-ext'\nimport { observableFromOlEvent } from '../rx-ext'\nimport { instanceOf } from '../util/assert'\nimport rxSubs from './rx-subs'\n\nexport default {\n  mixins: [rxSubs],\n  computed: {\n    overlayIds () {\n      if (!this.rev) return []\n\n      return this.getOverlays().map(getOverlayId)\n    },\n  },\n  methods: {\n    /**\n     * @param {Overlay|Vue} overlay\n     * @return {void}\n     */\n    addOverlay (overlay) {\n      overlay = overlay instanceof Vue ? overlay.$overlay : overlay\n      instanceOf(overlay, Overlay)\n\n      if (this.getOverlayById(getOverlayId(overlay)) == null) {\n        initializeOverlay(overlay)\n        this._overlaysCollection.push(overlay)\n      }\n    },\n    /**\n     * @param {Overlay|Vue} overlay\n     * @return {void}\n     */\n    removeOverlay (overlay) {\n      overlay = this.getOverlayById(getOverlayId(overlay))\n      if (!overlay) return\n\n      this._overlaysCollection.remove(overlay)\n    },\n    /**\n     * @return {Overlay[]}\n     */\n    getOverlays () {\n      return this._overlaysCollection.getArray()\n    },\n    /**\n     * @return {Collection<Overlay>}\n     */\n    getOverlaysCollection () {\n      return this._overlaysCollection\n    },\n    /**\n     * @param {string|number} overlayId\n     * @return {Overlay|undefined}\n     */\n    getOverlayById (overlayId) {\n      return this._overlaysCollection.getArray().find(overlay => {\n        return getOverlayId(overlay) === overlayId\n      })\n    },\n    /**\n     * @return {void}\n     */\n    clearOverlays () {\n      this._overlaysCollection.clear()\n    },\n    /**\n     * @returns {Object}\n     * @protected\n     */\n    getServices () {\n      const vm = this\n\n      return {\n        get overlaysContainer () { return vm },\n      }\n    },\n  },\n  created () {\n    /**\n     * @type {Collection<Overlay>}\n     * @private\n     */\n    this._overlaysCollection = new Collection()\n\n    const add = observableFromOlEvent(this._overlaysCollection, 'add')\n    const remove = observableFromOlEvent(this._overlaysCollection, 'remove')\n    const events = mergeObs(add, remove)\n\n    this.subscribeTo(events, ({ type, element }) => {\n      ++this.rev\n\n      this.$emit(type + ':overlay', element)\n    })\n  },\n}\n"],"names":["mixins","rxSubs","computed","overlayIds","rev","getOverlays","map","getOverlayId","methods","addOverlay","overlay","Vue","$overlay","instanceOf","Overlay","getOverlayById","initializeOverlay","_overlaysCollection","push","removeOverlay","remove","getArray","getOverlaysCollection","overlayId","find","clearOverlays","clear","getServices","vm","overlaysContainer","created","Collection","add","observableFromOlEvent","events","mergeObs","subscribeTo","type","element","$emit"],"mappings":";;;;;;;;;;;;;;;;;;;AASA,wBAAe;EACbA,MAAM,EAAE,CAACC,MAAD,CADK;EAEbC,QAAQ,EAAE;IACRC,UADQ,wBACM;UACR,CAAC,KAAKC,GAAV,EAAe,OAAO,EAAP;aAER,KAAKC,WAAL,GAAmBC,GAAnB,CAAuBC,YAAvB,CAAP;;GANS;EASbC,OAAO,EAAE;;;;;IAKPC,UALO,sBAKKC,OALL,EAKc;MACnBA,OAAO,GAAGA,OAAO,YAAYC,GAAnB,GAAyBD,OAAO,CAACE,QAAjC,GAA4CF,OAAtD;MACAG,UAAU,CAACH,OAAD,EAAUI,OAAV,CAAV;;UAEI,KAAKC,cAAL,CAAoBR,YAAY,CAACG,OAAD,CAAhC,KAA8C,IAAlD,EAAwD;QACtDM,iBAAiB,CAACN,OAAD,CAAjB;;aACKO,mBAAL,CAAyBC,IAAzB,CAA8BR,OAA9B;;KAXG;;;;;;IAkBPS,aAlBO,yBAkBQT,OAlBR,EAkBiB;MACtBA,OAAO,GAAG,KAAKK,cAAL,CAAoBR,YAAY,CAACG,OAAD,CAAhC,CAAV;UACI,CAACA,OAAL,EAAc;;WAETO,mBAAL,CAAyBG,MAAzB,CAAgCV,OAAhC;KAtBK;;;;;IA2BPL,WA3BO,yBA2BQ;aACN,KAAKY,mBAAL,CAAyBI,QAAzB,EAAP;KA5BK;;;;;IAiCPC,qBAjCO,mCAiCkB;aAChB,KAAKL,mBAAZ;KAlCK;;;;;;IAwCPF,cAxCO,0BAwCSQ,SAxCT,EAwCoB;aAClB,KAAKN,mBAAL,CAAyBI,QAAzB,GAAoCG,IAApC,CAAyC,UAAAd,OAAO,EAAI;eAClDH,YAAY,CAACG,OAAD,CAAZ,KAA0Ba,SAAjC;OADK,CAAP;KAzCK;;;;;IAgDPE,aAhDO,2BAgDU;WACVR,mBAAL,CAAyBS,KAAzB;KAjDK;;;;;;IAuDPC,WAvDO,yBAuDQ;UACPC,EAAE,GAAG,IAAX;aAEO;YACDC,iBAAJ,GAAyB;iBAASD,EAAP;;;OAD7B;;GAnES;EAwEbE,OAxEa,qBAwEF;;;;;;;SAKJb,mBAAL,GAA2B,IAAIc,UAAJ,EAA3B;QAEMC,GAAG,GAAGC,qBAAqB,CAAC,KAAKhB,mBAAN,EAA2B,KAA3B,CAAjC;QACMG,MAAM,GAAGa,qBAAqB,CAAC,KAAKhB,mBAAN,EAA2B,QAA3B,CAApC;QACMiB,MAAM,GAAGC,KAAQ,CAACH,GAAD,EAAMZ,MAAN,CAAvB;SAEKgB,WAAL,CAAiBF,MAAjB,EAAyB,gBAAuB;UAApBG,IAAoB,QAApBA,IAAoB;UAAdC,OAAc,QAAdA,OAAc;QAC5C,KAAI,CAAClC,GAAP;;MAEA,KAAI,CAACmC,KAAL,CAAWF,IAAI,GAAG,UAAlB,EAA8BC,OAA9B;KAHF;;CAnFJ;;;;"}