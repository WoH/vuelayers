{"version":3,"file":"identity-map.js","sources":["src/util/identity-map.js"],"sourcesContent":["/**\n * Simple Identity map with refs count\n */\nexport default class IdentityMap {\n  pools = Object.create(null)\n\n  /**\n   * @param {string} pool\n   * @private\n   */\n  _preparePool (pool) {\n    this.pools[pool] || (this.pools[pool] = Object.create(null))\n  }\n\n  /**\n   * @param {string} id\n   * @param {*} value\n   * @param {string} pool\n   */\n  set (id, value, pool = 'default') {\n    if (value == null) return\n\n    this._preparePool(pool)\n\n    this.pools[pool][id] = {\n      value,\n      refs: 1,\n    }\n  }\n\n  /**\n   * @param {string} id\n   * @param {string} pool\n   */\n  get (id, pool = 'default') {\n    this._preparePool(pool)\n\n    let rec = this.pools[pool][id]\n    if (!rec || rec.value == null) return\n\n    rec.refs++\n    this.pools[pool][id] = rec\n\n    return rec.value\n  }\n\n  /**\n   * @param {string} id\n   * @param {string} pool\n   */\n  unset (id, pool = 'default') {\n    this._preparePool(pool)\n\n    let rec = this.pools[pool][id]\n    if (!rec || rec.value == null) return\n\n    rec.refs--\n    if (rec.refs === 0) {\n      delete this.pools[pool][id]\n    } else {\n      this.pools[pool][id] = rec\n    }\n  }\n\n  /**\n   * @param {string} id\n   * @param {string} pool\n   * @return {boolean}\n   */\n  has (id, pool = 'default') {\n    this._preparePool(pool)\n\n    return !!this.pools[pool][id]\n  }\n\n  /**\n   * @param {string} pool\n   * @return {string[]}\n   */\n  ids (pool = 'default') {\n    this._preparePool(pool)\n\n    return Object.keys(this.pools[pool])\n  }\n\n  /**\n   * @param {string} id\n   * @param {string} pool\n   * @return {*}\n   */\n  refs (id, pool = 'default') {\n    this._preparePool(pool)\n\n    return this.has(id, pool) ? this.pools[pool][id].refs : undefined\n  }\n}\n"],"names":["IdentityMap","Object","create","pool","pools","id","value","_preparePool","refs","rec","keys","has","undefined"],"mappings":";;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;AAAA;;;IAGqBA;;;;;;mCACXC,MAAM,CAACC,MAAP,CAAc,IAAd;;;;;;;;;;iCAMMC,MAAM;WACbC,KAAL,CAAWD,IAAX,MAAqB,KAAKC,KAAL,CAAWD,IAAX,IAAmBF,MAAM,CAACC,MAAP,CAAc,IAAd,CAAxC;;;;;;;;;;wBAQGG,IAAIC,OAAyB;UAAlBH,IAAkB,uEAAX,SAAW;UAC5BG,KAAK,IAAI,IAAb,EAAmB;;WAEdC,YAAL,CAAkBJ,IAAlB;;WAEKC,KAAL,CAAWD,IAAX,EAAiBE,EAAjB,IAAuB;QACrBC,KAAK,EAALA,KADqB;QAErBE,IAAI,EAAE;OAFR;;;;;;;;;wBAUGH,IAAsB;UAAlBF,IAAkB,uEAAX,SAAW;;WACpBI,YAAL,CAAkBJ,IAAlB;;UAEIM,GAAG,GAAG,KAAKL,KAAL,CAAWD,IAAX,EAAiBE,EAAjB,CAAV;UACI,CAACI,GAAD,IAAQA,GAAG,CAACH,KAAJ,IAAa,IAAzB,EAA+B;MAE/BG,GAAG,CAACD,IAAJ;WACKJ,KAAL,CAAWD,IAAX,EAAiBE,EAAjB,IAAuBI,GAAvB;aAEOA,GAAG,CAACH,KAAX;;;;;;;;;0BAOKD,IAAsB;UAAlBF,IAAkB,uEAAX,SAAW;;WACtBI,YAAL,CAAkBJ,IAAlB;;UAEIM,GAAG,GAAG,KAAKL,KAAL,CAAWD,IAAX,EAAiBE,EAAjB,CAAV;UACI,CAACI,GAAD,IAAQA,GAAG,CAACH,KAAJ,IAAa,IAAzB,EAA+B;MAE/BG,GAAG,CAACD,IAAJ;;UACIC,GAAG,CAACD,IAAJ,KAAa,CAAjB,EAAoB;eACX,KAAKJ,KAAL,CAAWD,IAAX,EAAiBE,EAAjB,CAAP;OADF,MAEO;aACAD,KAAL,CAAWD,IAAX,EAAiBE,EAAjB,IAAuBI,GAAvB;;;;;;;;;;;wBASCJ,IAAsB;UAAlBF,IAAkB,uEAAX,SAAW;;WACpBI,YAAL,CAAkBJ,IAAlB;;aAEO,CAAC,CAAC,KAAKC,KAAL,CAAWD,IAAX,EAAiBE,EAAjB,CAAT;;;;;;;;;0BAOqB;UAAlBF,IAAkB,uEAAX,SAAW;;WAChBI,YAAL,CAAkBJ,IAAlB;;aAEOF,MAAM,CAACS,IAAP,CAAY,KAAKN,KAAL,CAAWD,IAAX,CAAZ,CAAP;;;;;;;;;;yBAQIE,IAAsB;UAAlBF,IAAkB,uEAAX,SAAW;;WACrBI,YAAL,CAAkBJ,IAAlB;;aAEO,KAAKQ,GAAL,CAASN,EAAT,EAAaF,IAAb,IAAqB,KAAKC,KAAL,CAAWD,IAAX,EAAiBE,EAAjB,EAAqBG,IAA1C,GAAiDI,SAAxD;;;;;;;;;"}